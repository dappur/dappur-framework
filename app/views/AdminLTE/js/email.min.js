$(function(){$(document).ready(function(){var s;CKEDITOR.config.extraPlugins="justify,colordialog",CKEDITOR.on("instanceReady",function(e){e.editor.on("focus",function(e){s="html"})}),CKEDITOR.replace("html",{skin:"kama"}),$(".cke_editable").focus(function(){}),$("#subject").focus(function(){s="subject"}),$(document).on("click",".placeholder-insert",function(){if("html"==s&&CKEDITOR.instances.html.insertHtml($(this).attr("data-insert")),"subject"==s){var e=jQuery("#subject"),t=e[0].selectionStart,n=e.val();e.val(n.substring(0,t)+$(this).attr("data-insert")+n.substring(t))}}),$(document).on("click","#add-placeholder-custom",function(){swal({title:"Add Custom Data Field",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(n){return new Promise(function(e,t){n==n.match("^[a-z0-9_]*$")?($("#custom-placeholder-row").is(":visible")||$("#custom-placeholder-row").show(),$("#custom-placeholder-row").append('<div style="float: left; margin: 5px;"><span class="btn btn-default placeholder-insert placeholder-custom" data-insert="{{ '+n+' }}">{{ '+n+' }}</span><span class="btn btn-danger placeholder-delete"><i class="fa fa-close"></i></span><input type="hidden" name="placeholders[]" value="'+n+'"></div>'),e()):t("Data field be alphanumeric with underscores.")})},allowOutsideClick:!1}).then(function(e){swal({type:"success",title:"Custom Data Field Added!",html:"[[ "+e+" ]]"}),$("body").getNiceScroll().resize()})}),$(document).on("click",".placeholder-delete",function(){$(this).parent().remove(),1==$("#custom-placeholder-row").children().length&&($("#custom-placeholder-row").hide(),$("body").getNiceScroll().resize())}),$(document).on("mousedown","#cke_1_resizer",function(e){$(document).mousemove(function(){$("body").getNiceScroll().resize()})}),$(document).on("click","#send-test",function(e){var s=$("#subject").val(),o=CKEDITOR.instances.html.getData();swal({title:"Would you like to send a test email to yourself?",type:"question",showCancelButton:!0,confirmButtonText:"Send",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(t,n){DappurCSRF.csrfAjax("/dashboard/email/test",{subject:s,html:o},function(e){parsed=jQuery.parseJSON(e),"error"==parsed.status?n("An error occurred sending your test email."):t()})})},allowOutsideClick:!1}).then(function(){swal({type:"success",title:"Test mail has been successfully sent."})})}),$("#send_to").select2({width:"100%",ajax:{url:"/dashboard/email/search-users",data:function(e){return{search:e.term}},processResults:function(e,t){if("success"==e.status)return{results:$.map(e.results,function(e){return{text:e.first_name+" "+e.last_name+" ("+e.email+")",id:e.id}})};if(n=t.term,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())){new Option(t.term,t.term,!0,!0);return{results:[{id:t.term,text:t.term}]}}return!1;var n}}})})});