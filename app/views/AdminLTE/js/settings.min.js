$(function(){function e(){$(".dappur-save-html").data("html",""),$(".html-modal-title").html(""),$(".tinymce").html(""),tinymce.remove()}$("#import_file").fileupload({dataType:"json",done:function(t,e){"success"==e.result.status?window.location.replace(window.location.href):swal({type:"error",title:e.result.message})}}),$(document).ready(function(){$("#groups_table").DataTable({responsive:!0,stateSave:!0}),1==$("#page").val()?$(".ispage").show():$(".ispage").hide()}),$(document).on("change","#page",function(){1==$(this).val()?$(".ispage").show():$(".ispage").hide()}),$(document).on("change","#add_type",function(){var t=$(this).val();if(6==t)$("#value_input").html('<select name="add_value" id="add_value" class="form-control" required="required"><option value="0">False</option><option value="1">True</option></select>');else if(5==t)$("#value_input").html('<div class="input-group dm-input" data-name="add_value" data-value=""></div>'),DappurMedia.refreshInputs();else if(4==t)$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">');else if(3==t)$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">');else if(8==t){$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control jscolor" value="#FFFFFF" placeholder="Value">');var e=document.getElementById("add_value");window.pickeradd=new jscolor(e,{width:243,height:150,borderColor:"#FFF",insetColor:"#FFF",backgroundColor:"#666",hash:!0})}else 2==t?$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">'):1==t?$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">'):7==t?$("#value_input").html('<div class="row"><div class="col-md-6"><button type="button" class="btn btn-info dappur-html-preview form-control" data-html="add_value">Preview</button><input type="hidden" name="add_value" id="add_value" value=""></div><div class="col-md-6"><button type="button" class="btn btn-warning dappur-html-edit form-control" data-html="add_value">Edit HTML</button></div></div>'):$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">')}),$(document).on("click",".dappur-html-preview",function(){var t=$(this).data("html"),e=$("#"+t).val();$(".html-modal-title").html(t),$(".dappur-save-html").hide(),$(".tinymce").html(e),$("#html-modal").modal("show")}),$(document).on("click",".dappur-save-html",function(){var t=$(this).data("html");$("#"+t).val(tinyMCE.activeEditor.getContent()).trigger("change"),e(),$("#html-modal").modal("hide")}),$(document).on("click",".dappur-html-edit",function(){var t=$(this).data("html"),e=$("#"+t).val();$(".html-modal-title").html(t),$(".dappur-save-html").data("html",t),$(".dappur-save-html").show(),$(".tinymce").html(e),tinymce.init({selector:".tinymce",theme:"modern",height:"300",paste_data_images:!0,plugins:["advlist autolink lists link charmap print preview hr anchor pagebreak image","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern"],toolbar1:"undo redo | styleselect forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | code",toolbar2:"media_local cloudinary",bootstrapConfig:{imagesPath:"/uploads/"},branding:!1,convert_urls:!1,setup:function(t){t.addButton("media_local",{text:"Local Media",icon:!1,onclick:function(){DappurMedia.loadMedia("blog","post_content")}}),hasCloudinary&&t.addButton("cloudinary",{text:"Cloudinary",icon:!1,onclick:function(){DappurCloudinary.loadCloudinary("blog","post_content")}})}}),$("#html-modal").modal("show")}),$("#html-modal").on("hidden.bs.modal",function(){e(),$(".tinymce").html("")});var a='<span class="config-save"><i class="fa fa-check"></i> Save</span> <span class="config-cancel"><i class="fa fa-close"></i> Cancel</span>',n='<span class="config-edit"><i class="fa fa-edit"></i> Edit</span>';$(document).on("click",".config-edit",function(){var t=$(this).parents(".config-button");$(this).parents("label").siblings("input").length&&($(this).parents("label").siblings("input").attr("disabled",!1),t.html(a)),t.siblings(".config-delete").hide(),$(this).parents("label").siblings("select").length&&($(this).parents("label").siblings("select").attr("disabled",!1),t.html(a)),$(this).parents("label").siblings(".dm-input").children("input").length&&($(this).parents("label").siblings(".dm-input").children("input").attr("readonly",!1),t.html(a))}),$(document).on("click",".config-cancel",function(){var t=$(this).parents(".config-button"),e=$(this).parents("label").siblings("input");e.length&&(e.attr("disabled",!0),e.val(t.data("default")),(e.hasClass("jscolor")||e.hasClass("htmlinput"))&&(e.hasClass("jscolor")&&e.css("background-color",t.data("default")),e.hasClass("htmlinput")&&e.siblings(".row").children("button").data("html",t.data("default"))),t.html(n));var a=$(this).parents("label").siblings("select");a.length&&(a.prop("disabled",!0),a.val(t.data("default")),t.html(n));var l=$(this).parents("label").siblings(".dm-input").children("input");l.length&&(l.prop("readonly",!0),l.val(t.data("default")),t.html(n)),t.siblings(".config-delete").show()}),$(document).on("click",".config-save",function(){var e,t,a=$(this).parents(".config-button");$(this).parents("label").siblings("input").length&&((t={})[(e=$(this).parents("label").siblings("input")).attr("name")]=e.val(),e.attr("disabled",!0));$(this).parents("label").siblings("select").length&&((t={})[(e=$(this).parents("label").siblings("select")).attr("name")]=e.val(),e.prop("disabled",!0));$(this).parents("label").siblings(".dm-input").children("input").length&&((t={})[(e=$(this).parents("label").siblings(".dm-input").children("input")).attr("name")]=e.val(),e.prop("disabled",!0));a.html(' <i class="fa fa-refresh fa-spin"></i> Saving'),DappurCSRF.csrfAjax("/dashboard/settings/save",t,function(t){parsed=jQuery.parseJSON(t),"success"==parsed.status?(a.html('<span class="config-saved"><i class="fa fa-check"></i> Saved</span>'),a.children(".config-saved").fadeOut(2e3,function(){$(this).remove(),a.siblings(".config-delete").show(),e.hasClass("jscolor")||e.hasClass("htmlinput"),a.html(n),a.siblings(".config-delete").show()}),a.data("default",e.val())):(swal({type:"error",title:parsed.message}),e.hasClass("jscolor")||e.hasClass("htmlinput"),a.html(n),a.siblings(".config-delete").show(),e.val(a.data("default")))})}),$(document).on("click",".config-delete",function(){var t=$(this).parents(".config-button"),e=$(this).closest(".form-group");t.html(' <i class="fa fa-refresh fa-spin"></i> Deleting...');var l={};l.config_name=$(this).data("name"),swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",allowOutsideClick:!1,preConfirm:function(){return new Promise(function(e,a){DappurCSRF.csrfAjax("/dashboard/settings/delete",l,function(t){"success"==(t=jQuery.parseJSON(t)).status?e():a(t.message)})})}}).then(function(){e.remove(),swal({text:"Setting has been permenantly deleted.",type:"success"})})}),$(document).on("change",".dm-image",function(){var t=$(this).parent().siblings("label").children(".config-button"),e=$(this);({})[e.attr("name")]=e.val(),e.attr("disabled",!0),t.html(a)}),$(document).on("change",".jscolor-config",function(){var t=$(this).siblings("label").children(".config-button"),e=$(this);({})[e.attr("name")]=e.val(),t.html(a)}),$(document).on("change",".htmlinput",function(){var t=$(this).siblings("label").children(".config-button"),e=$(this);({})[e.attr("name")]=e.val(),e.attr("disabled",!0),t.html(a)}),$(document).on("click",'[data-toggle="collapse"]',function(){$(this).children("i").toggleClass("fa-minus fa-plus")})});