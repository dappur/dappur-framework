$(document).ready(function(){var o;CKEDITOR.config.extraPlugins="justify,colordialog",CKEDITOR.on("instanceReady",function(e){e.editor.on("focus",function(e){o="html"})}),CKEDITOR.replace("html",{skin:"kama"}),$("#subject").focus(function(){o="subject"}),$(document).on("click",".placeholder-insert",function(){if("html"==o&&CKEDITOR.instances.html.insertHtml($(this).attr("data-insert")),"plain_text"==o){var e=(n=jQuery("#plain_text"))[0].selectionStart,t=n.val();n.val(t.substring(0,e)+$(this).attr("data-insert")+t.substring(e))}if("subject"==o){var n=jQuery("#subject");e=n[0].selectionStart,t=n.val();n.val(t.substring(0,e)+$(this).attr("data-insert")+t.substring(e))}}),$(document).on("click","#add-placeholder-custom",function(){swal({title:"Add Custom Data Field",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(n){return new Promise(function(e,t){n==n.match("^[a-z0-9_]*$")?($("#custom-placeholder-row").is(":visible")||$("#custom-placeholder-row").show(),$("#custom-placeholder-row").append('<div style="float: left; margin: 5px;"><span class="btn btn-default placeholder-insert placeholder-custom" data-insert="{{ '+n+' }}">{{ '+n+' }}</span><span class="btn btn-danger placeholder-delete"><i class="fa fa-close"></i></span><input type="hidden" name="placeholders[]" value="'+n+'"></div>'),e()):t("Data field be alphanumeric with underscores.")})},allowOutsideClick:!1}).then(function(e){swal({type:"success",title:"Custom Data Field Added!",html:"[[ "+e+" ]]"}),$("body").getNiceScroll().resize()})}),$(document).on("click",".placeholder-delete",function(){$(this).parent().remove(),1==$("#custom-placeholder-row").children().length&&($("#custom-placeholder-row").hide(),$("body").getNiceScroll().resize())}),$(document).on("mousedown","#cke_1_resizer",function(e){$(document).mousemove(function(){$("body").getNiceScroll().resize()})}),$(document).on("click","#send-test",function(e){var o=$("#subject").val(),s=CKEDITOR.instances.html.getData();swal({title:"Would you like to send a test email to yourself?",type:"question",showCancelButton:!0,confirmButtonText:"Send",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(t,n){DappurCSRF.csrfAjax("/dashboard/email/test",{subject:o,html:s},function(e){parsed=jQuery.parseJSON(e),"error"==parsed.status?n("An error occurred sending your test email."):t()})})},allowOutsideClick:!1}).then(function(){swal({type:"success",title:"Test mail has been successfully sent."})})})});