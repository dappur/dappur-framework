var DappurMedia=new function(){this.managerUrl=null,this.getFolderUrl=null,this.addFolderUrl=null,this.deleteMediaUrl=null,this.loadMedia=function(e,t){switch($("#media-modal-body").html(""),e){case"menu":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+'?source=menu"></iframe>');break;case"input":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+"?source=input&target="+t+'"></iframe>');break;case"blog":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+"?source=blog&target="+t+'"></iframe>');break;case"blog_featured":case"seo_featured":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+"?source=blog_featured&target="+t+'"></iframe>')}$("#media-modal").modal("show")},this.createFolder=function(a){var r=this.addFolderUrl;swal({title:"Create a New Folder",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(e){return new Promise(function(t,i){DappurCSRF.csrfAjax(r,{current_folder:a,new_folder_name:e},function(e){if(parsed=jQuery.parseJSON(e),"error"==parsed.result){var a="";$.each(parsed.data,function(e,t){a=a+"<br />"+t}),i(a)}else"success"==parsed.result?t():i("An unknown error occured.")})})},allowOutsideClick:!1}).then(function(e){DappurMedia.getFolder(a+"/"+e),swal({type:"success",title:"New folder created successfully!",html:a+"/"+e})}).catch(swal.noop)},this.deleteMedia=function(a,r){var n=this.deleteMediaUrl;swal({title:"Are you sure you want to delete this file?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,preConfirm:function(e){return new Promise(function(t,i){DappurCSRF.csrfAjax(n,{current_folder:a,current_file:r},function(e){if(parsed=jQuery.parseJSON(e),"error"==parsed.result){var a="";$.each(parsed.data,function(e,t){a=a+"<br />"+t}),i(a)}else"success"==parsed.result?t():i("An unknown error occured.")})})},allowOutsideClick:!1}).then(function(e){DappurMedia.getFolder(a),$("#media-modal-info").modal("hide"),swal({type:"success",title:"File was removed successfully! Yay you!",html:a+"/"+r})}).catch(swal.noop)},this.getFolder=function(a){$("#loader").show(),$("#folder_list").html(""),$("#file_list").html(""),DappurCSRF.csrfAjax(this.getFolderUrl,{directory:a},function(e){if(parsed=jQuery.parseJSON(e),$("#breadcrumb").html(""),$("#folder_list").html(""),$("#file_list").html(""),$("#breadcrumb").data("current",a),""==a)$("#breadcrumb").html("/ &nbsp;<li>uploads</li>");else{$("#breadcrumb").html("/ &nbsp;<li>uploads</li>");var t=a.split("/");$.each(t,function(e,t){""!=t&&$("#breadcrumb").append("<li>"+t+"</li>")})}""!=a?$("#back-button").show():$("#back-button").hide(),"error"==parsed.status&&swal("Oops...","You do not have permission to access that folder!","error"),$("#loader").hide(),$.each(parsed.folders,function(e,t){$("#folder_list").append('<div class="col-sm-2 col-xs-4 media-folder" data-folder="'+t+'" style="margin-bottom: 20px;"><div style="line-height: 100px;"><div style="height: 100px; width: 100px; margin: 0 auto 0 auto;"><i class="fa fa-folder" style="font-size: 100px;"></i></div></div><div>'+t+"</div></div>")}),$.each(parsed.files,function(e,t){"image"==t.type?$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+t.file+'" data-filetype="'+t.type+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><div style="line-height: 100px;"><img src="/uploads'+a+"/"+t.file+'" style="max-width: 100%; max-height: 100px; border-radius: 5px; margin-bottom: 5px;" /></div><div>'+t.file+"</div></div>"):$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+t.file+'" data-filetype="'+t.type+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><div style="line-height: 100px;"><div style="height: 100px; width: 100px; margin: 0 auto 5px auto;"><i class="fa fa-file" style="font-size: 100px;"></i></div></div><div>'+t.file+"</div></div>")})})},this.getUrlParameter=function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]},this.copyToClipboard=function(e){var t="mycustom-clipboard-textarea-hidden-id",a=document.getElementById(t);if(!a){var i=document.createElement("textarea");i.id=t,i.style.position="fixed",i.style.top=0,i.style.left=0,i.style.width="1px",i.style.height="1px",i.style.padding=0,i.style.border="none",i.style.outline="none",i.style.boxShadow="none",i.style.background="transparent",document.querySelector("body").appendChild(i),a=document.getElementById(t)}a.value=e,a.select()},this.refreshInputs=function(){$(".dm-input").each(function(){var e=$(this).data("name"),t=$(this).data("value");$(this).html('<span class="input-group-btn"><img id="'+e+'-thumbnail" src="'+t+'" style="max-height: 30px; max-width: 30px;" /></span><input type="text" name="'+e+'" id="'+e+'" class="form-control dm-image" value="'+t+'" readonly><span class="input-group-btn"><button type="button" class="btn btn-default image-preview" data-target="'+e+'"><i class="fa fa-eye"></i></button><button type="button" class="btn btn-default image-select" data-target="'+e+'"><i class="fa fa-picture-o"></i></button></span>')})},$(document).on("click","#media-menu",function(){DappurMedia.loadMedia("menu",null)}),$(document).on("dblclick",".media-folder",function(){var e=$("#breadcrumb").data("current")+"/"+$(this).data("folder");DappurMedia.getFolder(e)}),$(document).on("click","#back-button",function(){var e=$("#breadcrumb").data("current").split("/");e.splice(-1,1),newFolder=e.join("/"),DappurMedia.getFolder(newFolder)}),$(document).on("click","#refresh-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.getFolder(e)}),$(document).on("click","#new-folder-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.createFolder(e)}),$(document).on("dblclick",".media-file",function(){var e=$("#breadcrumb").data("current"),t=$(this).data("file"),a=$(this).data("filetype"),i="/uploads"+e+"/"+t;$("#file-info").data("file",t).data("filepath",i).html(t),"image"==a&&$("#media-image-preview").html('<img src="/uploads/'+e+"/"+t+'" style="max-width: 100%; max-height: 200px;" />'),$("#file-name").html(t),$("#file-path").html(i),$("#media-clipboard").val(i),$("#media-download-file").attr("href",i),$("#media-modal-info").modal("show"),new Clipboard("#media-info-btn-copy")}),$(document).on("hidden.bs.modal","#media-modal-info",function(){$("#media-image-preview").html(""),$("#file-name").html(""),$("#file-path").html(""),$("#file-info").data("file","").html(""),$("#media-clipboard").val(""),$("#media-download-file").attr("href","")}),$(document).on("click","#media-info-btn-copy",function(){var e=$("#file-info").data("filepath");DappurMedia.copyToClipboard(e),swal({title:'<span style="color: green;">Image url copied to clipboard!</span>',text:e}).catch(swal.noop)}),$(document).on("click","#media-info-btn-download",function(){document.getElementById("media-download-file").click()}),$(document).on("click","#media-info-btn-delete",function(){var e=$("#breadcrumb").data("current"),t=$("#file-info").data("file");DappurMedia.deleteMedia(e,t)}),$(document).on("click",".image-preview",function(e){e.preventDefault();var t=$(this).attr("data-target");swal({html:'<img src="'+$("#"+t).val()+'" style="width: 100%;">'}).catch(swal.noop)}),$(document).on("click","#upload-button",function(){var a=$("#breadcrumb").data("current");$("#current_folder").val(a),$("#fileupload").trigger("click"),$("#fileupload").fileupload({autoUpload:!0,singleFileUploads:!1,add:function(e,a){$.getJSON("/csrf",function(e){var t;t=e,a.formData={},a.formData[t.name_key]=t.name,a.formData[t.value_key]=t.value,a.submit()})},done:function(e,t){DappurMedia.getFolder(a)}})}),$(document).ready(function(){var e;$(".dm-input").each(function(){var e=$(this).data("name"),t=$(this).data("value");$(this).html('<span class="input-group-btn"><img id="'+e+'-thumbnail" src="'+t+'" style="max-height: 30px; max-width: 30px;" /></span><input type="text" name="'+e+'" id="'+e+'" class="form-control dm-image" value="'+t+'" readonly><span class="input-group-btn"><button type="button" class="btn btn-default image-preview" data-target="'+e+'"><i class="fa fa-eye"></i></button><button type="button" class="btn btn-default image-select" data-target="'+e+'"><i class="fa fa-picture-o"></i></button></span>')});try{DappurCloudinary,e=!0}catch(e){}e?$(document).on("click",".image-select",function(e){e.preventDefault(),DappurCloudinary.loadCloudinary("input",$(this).attr("data-target"))}):$(document).on("click",".image-select",function(e){e.preventDefault(),DappurMedia.loadMedia("input",$(this).attr("data-target"))})}),$(document).on("click","#media-info-btn-insert",function(){var i=$("#file-info").data("filepath"),e=DappurMedia.getUrlParameter("target"),t=DappurMedia.getUrlParameter("source");"input"==t?($(parent.document).find("#"+e).val(i).change(),$(parent.document).find("#"+e+"-thumbnail").attr("src",i),window.parent.$("#media-modal").modal("hide")):"blog"==t?$.getScript("https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.7.1/tinymce.min.js",function(e,t,a){top.tinymce.activeEditor.insertContent('<img src="'+i+'" class="img-responsive" style="width: 100%;" />'),window.parent.$("#media-modal").modal("hide")}):"blog_featured"==t?(window.parent.$("#featured_thumbnail").html('<img src="'+i+'" class="img-responsive" alt="Featured Image" style="width: 100%;">'),window.parent.$("#featured_image").val(i),window.parent.$("#media-modal").modal("hide")):"seo_featured"==t&&(window.parent.$("#featured_thumbnail").html('<img src="'+i+'" class="img-responsive" alt="Featured Image" style="width: 100%;">'),window.parent.$("#featured_image").val(i),window.parent.$("#media-modal").modal("hide"))})};