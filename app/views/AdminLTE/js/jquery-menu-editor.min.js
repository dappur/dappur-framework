function MenuEditor(n,s){var i=$("#"+n),r={labelEdit:'<i class="glyphicon glyphicon-edit clickable"></i>',labelRemove:'<i class="glyphicon glyphicon-remove clickable"></i>',textConfirmDelete:"This item will be deleted. Are you sure?",iconPicker:{cols:5,footer:!1},listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fa fa-minus"></i>',open:'<i class="fa fa-plus"></i>',openerCss:{"margin-right":"10px"},openerClass:"btn btn-success btn-xs"},placeholderCss:{"background-color":"gray"}}};$.extend(!0,r,s);var t=null,l=!0,a=null,o=null,c=null,e=r.iconPicker,d=(s=r.listOptions,$("#"+n+"_icon").iconpicker(e));function p(){a[0].reset(),(d=d.iconpicker(e)).iconpicker("setIcon","empty"),o.attr("disabled",!0),o.hide(),c.attr("disabled",!0),c.hide(),t=null,$("#active, #roles, #page").select2({width:"100%"}),$("#classes").html(""),$("#classes").select2({width:"100%",tags:!0,createTag:function(e){return{id:e.term,text:e.term,newOption:!0}}}),$("[data-toggle='toggle']").bootstrapToggle("destroy"),$.each($("[data-toggle='toggle']"),function(e,t){$(this).val("false"),$(this).bootstrapToggle("off")})}function u(e){return $("<a>").addClass(e.classCss).addClass("clickable").attr("href","#").html(e.text)}function h(){var e=$("<div>").addClass("btn-group pull-right"),t=u({classCss:"btn btn-primary btn-xs btnEdit",text:r.labelEdit}),s=u({classCss:"btn btn-danger btn-xs btnRemove",text:r.labelRemove}),l=u({classCss:"btn btn-default btn-xs btnUp btnMove",text:'<i class="glyphicon glyphicon-chevron-up clickable"></i>'}),n=u({classCss:"btn btn-default btn-xs btnDown btnMove",text:'<i class="glyphicon glyphicon-chevron-down clickable"></i>'}),o=u({classCss:"btn btn-default btn-xs btnOut btnMove",text:'<i class="glyphicon glyphicon-save clickable"></i>'}),i=u({classCss:"btn btn-default btn-xs btnIn btnMove",text:'<i class="glyphicon glyphicon-export clickable"></i>'});return e.append(l).append(n).append(i).append(o).append(t).append(s),e}function f(e){$("<span>").addClass("sortableListsOpener "+s.opener.openerClass).css(s.opener.openerCss).on("mousedown",function(e){var t=$(this).closest("li");return t.hasClass("sortableListsClosed")?t.iconOpen(s):t.iconClose(s),!1}).prependTo(e.children("div").first()),e.hasClass("sortableListsOpen")?e.iconOpen(s):e.iconClose(s)}i.sortableLists(r.listOptions),d.on("change",function(e){var t=""!==e.iconClass?e.iconClass+" ":"";a.find("[name=icon]").val(t+e.icon)}),$(document).on("click",".btnRemove",function(e){e.preventDefault();var l=$(this);swal({title:"Are you sure?",text:r.textConfirmDelete,type:"warning",showCancelButton:!0,cancelButtonText:"No, cancel!",confirmButtonText:"Yes, I am sure!",reverseButtons:!0,cancelButtonColor:"red",confirmButtonColor:"green"}).then(function(e){if(e){var t=l.closest("ul");l.closest("li").remove();var s=!1;void 0!==t.attr("id")&&(s=t.attr("id").toString()===n),t.children().length||s||(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),MenuEditor.updateButtons(i)}else swal("Cancelled","Your imaginary file is safe :)","error")})}),$(document).on("click",".btnEdit",function(e){e.preventDefault(),function(e){var t=e.data();$.each(t,function(e,t){"classes"==e?$.each(t,function(e,t){$("#classes").append('<option value="'+t+'" selected>'+t+"</option>")}):a.find("[name="+e+"]").val(t)}),a.find(".item-menu").first().focus(),t.hasOwnProperty("icon")&&d.iconpicker("setIcon",(s=t.icon,1===(l=s.split(" ")).length?l[0]:2===l.length?l[1]:"empty"));var s,l;o.removeAttr("disabled"),o.show(),c.removeAttr("disabled"),c.show()}(t=$(this).closest("li")),$("#active, #roles, #page").select2({width:"100%"}),$("#classes").select2({width:"100%",tags:!0,createTag:function(e){return{id:e.term,text:e.term,newOption:!0}}}),$("[data-toggle='toggle']").bootstrapToggle("destroy"),$.each($("[data-toggle='toggle']"),function(e,t){"true"==$(this).val()?($(this).attr("checked",!0),$(this).bootstrapToggle("on")):$(this).bootstrapToggle("off")})}),i.on("click",".btnUp",function(e){e.preventDefault();var t=$(this).closest("li");t.prev("li").before(t),MenuEditor.updateButtons(i)}),i.on("click",".btnDown",function(e){e.preventDefault();var t=$(this).closest("li");t.next("li").after(t),MenuEditor.updateButtons(i)}),i.on("click",".btnOut",function(e){e.preventDefault();var t=$(this).closest("ul"),s=$(this).closest("li");s.closest("ul").closest("li").after(s),t.children().length<=0&&(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),MenuEditor.updateButtons(i)}),i.on("click",".btnIn",function(e){e.preventDefault();var t=$(this).closest("li"),s=t.prev("li");if(0<s.length)if(0<(l=s.children("ul")).length)l.append(t);else{var l=$("<ul>");s.append(l),l.append(t),s.addClass("sortableListsOpen"),f(s)}MenuEditor.updateButtons(i)}),this.setForm=function(e){a=e},this.getForm=function(){return a},this.setUpdateButton=function(e){(o=e).attr("disabled",!0),t=null},this.getUpdateButton=function(){return o},this.setCancelButton=function(e){(c=e).attr("disabled",!0),t=null},this.setActiveMenu=function(e){e},this.getCancelButton=function(){return c},this.getCurrentItem=function(){return t},this.update=function(){var e=this.getCurrentItem();if(null!==e){var t=e.data("icon");a.find(".item-menu").each(function(){e.data($(this).attr("name"),$(this).val())}),e.children().children("i").removeClass(t).addClass(e.data("icon")),e.find("span.txt").first().text(e.data("text")),p()}},this.clearForm=function(){p()},this.add=function(){var e={};a.find(".item-menu").each(function(){e[$(this).attr("name")]=$(this).val()});var t=h(),s=$("<span>").addClass("txt").text(e.text),l=$("<i>").addClass(e.icon),n=$("<div>").append(l).append("&nbsp;").append(s).append(t),o=$("<li>").data(e);o.addClass("list-group-item").append(n),i.append(o),MenuEditor.updateButtons(i),p()},this.getString=function(){var e=i.sortableListsToJson();return JSON.stringify(e)},this.setData=function(e){var t=Array.isArray(e)?e:function(e){try{var t=JSON.parse(e)}catch(e){return console.log("The string is not a json valid."),null}return t}(e);if(null!==t){i.empty();var s=function d(e,t){var p=void 0===t?0:t,u=0===p?i:$("<ul>");return $.each(e,function(e,t){var s=void 0!==t.children&&$.isArray(t.children),l={text:"",href:"",icon:"empty",target:"_self",title:""},n=$.extend({},t);s&&delete n.children,$.extend(l,n);var o=$("<li>").addClass("list-group-item");o.data(l);var i=$("<div>").css("margin-bottom","5px"),r=$("<i>").addClass(t.icon),a=$("<span>").addClass("txt").append(t.text),c=h();i.append(r).append("&nbsp;").append(a).append(c),o.append(i),s&&o.append(d(t.children,p+1)),u.append(o)}),u}(t);l?i.find("li").each(function(){var e=$(this);e.children("ul").length&&f(e)}):(s.sortableLists(r.listOptions),l=!0),MenuEditor.updateButtons(i)}}}!function(C){C.fn.sortableLists=function(e){var t=this,s=C("body").css("position","relative"),l={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(s.css("margin-top")),left:0-parseInt(s.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!0,as:"html",open:"",close:"",openerCss:{float:"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:!1,scroll:20,ignoreClass:"clickable",isAllowed:function(e,t,s){return!0},onDragStart:function(e,t){return!0},onChange:function(e){return!0},complete:function(e){return MenuEditor.updateButtons(t),!0}},d=C.extend(!0,{},l,e),p=C("<"+d.listSelector+" />").prependTo(s).attr("id","sortableListsBase").css(d.baseCss).addClass(d.listsClass+" "+d.baseClass),u=C("<li />").attr("id","sortableListsPlaceholder").css(d.placeholderCss).addClass(d.placeholderClass),h=C("<li />").attr("id","sortableListsHint").css(d.hintCss).addClass(d.hintClass),r=C("<"+d.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(d.listsClass+" "+d.hintWrapperClass).css(d.listsCss).css(d.hintWrapperCss),a=C("<span />").addClass("sortableListsOpener "+d.opener.openerClass).css(d.opener.openerCss).on("mousedown",function(e){var t=C(this).closest("li");return t.hasClass("sortableListsClosed")?t.iconOpen(d):t.iconClose(d),!1});"class"===d.opener.as?a.addClass(d.opener.close):"html"===d.opener.as&&a.html(d.opener.close);var f={isDragged:!1,isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:C(document),win:C(window)};if(d.opener.active){if(!d.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!d.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";C(this).find("li").each(function(){var e=C(this);e.children(d.listSelector).length&&(a.clone(!0).prependTo(e.children("div").first()),e.hasClass("sortableListsOpen")?e.iconOpen(d):e.iconClose(d))})}return this.on("mousedown",function(e){var t=C(e.target);if(!(!1!==f.isDragged||d.ignoreClass&&t.hasClass(d.ignoreClass))){e.preventDefault();var s=t.closest("li"),l=C(this);s[0]&&(d.onDragStart(e,s),function(e,t,s){f.isDragged=!0;var l=parseInt(t.css("margin-top")),n=parseInt(t.css("margin-bottom")),o=parseInt(t.css("margin-left")),i=parseInt(t.css("margin-right")),r=t.offset(),a=t.innerHeight();f.rootEl={el:s,offset:s.offset(),rootElClass:s.attr("class")},f.cEl={el:t,mT:l,mL:o,mB:n,mR:i,offset:r},f.cEl.xyOffsetDiff={X:e.pageX-f.cEl.offset.left,Y:e.pageY-f.cEl.offset.top},f.cEl.el.addClass("sortableListsCurrent "+d.currElClass),t.before(u);var c=f.placeholderNode=C("#sortableListsPlaceholder");t.css({width:t.width(),position:"absolute",top:r.top-C(window).scrollTop()-l,left:r.left-C(window).scrollLeft()-o}).prependTo(p),c.css({display:"block",height:a}),h.css("height",a),f.doc.on("mousemove",g).on("mouseup",v)}(e,s,l))}});function g(e){if(f.isDragged){var t=f.cEl,s=f.doc,l=f.win;e.pageX||((i=e).pageY=f.pY,i.pageX=f.pX,i.clientY=f.cY,i.clientX=f.cX),s.scrollTop()>f.rootEl.offset.top-10&&e.clientY<50?f.upScroll?(e.pageY=e.pageY-d.scroll,C("html, body").each(function(e){C(this).scrollTop(C(this).scrollTop()-d.scroll)}),c(e)):function(e){if(f.upScroll)return;f.upScroll=setInterval(function(){f.doc.trigger("mousemove")},50)}():s.scrollTop()+l.height()<f.rootEl.offset.top+f.rootEl.el.outerHeight(!1)+10&&l.height()-e.clientY<50?f.downScroll?(e.pageY=e.pageY+d.scroll,C("html, body").each(function(e){C(this).scrollTop(C(this).scrollTop()+d.scroll)}),c(e)):function(e){if(f.downScroll)return;f.downScroll=setInterval(function(){f.doc.trigger("mousemove")},50)}():b(f),f.oElOld=f.oEl,t.el[0].style.visibility="hidden",f.oEl=oEl=function(e,t){if(!document.elementFromPoint)return null;var s=f.isRelEFP;if(null===s){var l,n;0<(l=f.doc.scrollTop())&&(s=null==(n=document.elementFromPoint(0,l+C(window).height()-1))||"HTML"===n.tagName.toUpperCase()),0<(l=f.doc.scrollLeft())&&(s=null==(n=document.elementFromPoint(l+C(window).width()-1,0))||"HTML"===n.tagName.toUpperCase())}s&&(e-=f.doc.scrollLeft(),t-=f.doc.scrollTop());var o=C(document.elementFromPoint(e,t));{if(!f.rootEl.el.find(o).length)return null;if(o.is("#sortableListsPlaceholder")||o.is("#sortableListsHint"))return null;if(!o.is("li"))return(o=o.closest("li"))[0]?o:null;if(o.is("li"))return o}}(e.pageX,e.pageY),t.el[0].style.visibility="visible",function(e,t){var s=t.oEl;if(!s||!t.oElOld)return;var l=s.outerHeight(!1),n=e.pageY-s.offset().top;d.insertZonePlus?n<14?function(e,t,s){C("#sortableListsHintWrapper",f.rootEl.el).length&&h.unwrap();if(!s&&e.pageX-t.offset().left>d.insertZone){var l=t.children(),n=t.children(d.listSelector).first();if(n.children().first().is("#sortableListsPlaceholder"))return h.css("display","none");n.length?n.prepend(h):(l.first().after(h),h.wrap(r)),f.oEl&&t.iconOpen(d)}else{if(t.prev("#sortableListsPlaceholder").length)return h.css("display","none");t.before(h)}h.css("display","block"),f.isAllowed=d.isAllowed(f.cEl.el,h,h.parents("li").first())}(e,s,n<7):l-14<n&&function(e,t,s){C("#sortableListsHintWrapper",f.rootEl.el).length&&h.unwrap();if(!s&&e.pageX-t.offset().left>d.insertZone){var l=t.children(),n=t.children(d.listSelector).last();if(n.children().last().is("#sortableListsPlaceholder"))return h.css("display","none");n.length?l.last().append(h):(t.append(h),h.wrap(r)),f.oEl&&t.iconOpen(d)}else{if(t.next("#sortableListsPlaceholder").length)return h.css("display","none");t.after(h)}h.css("display","block"),f.isAllowed=d.isAllowed(f.cEl.el,h,h.parents("li").first())}(e,s,l-7<n):n<5?function(e,t){C("#sortableListsHintWrapper",f.rootEl.el).length&&h.unwrap();if(e.pageX-t.offset().left<d.insertZone){if(t.prev("#sortableListsPlaceholder").length)return h.css("display","none");t.before(h)}else{var s=t.children(),l=t.children(d.listSelector).first();if(l.children().first().is("#sortableListsPlaceholder"))return h.css("display","none");l.length?l.prepend(h):(s.first().after(h),h.wrap(r)),f.oEl&&t.iconOpen(d)}h.css("display","block"),f.isAllowed=d.isAllowed(f.cEl.el,h,h.parents("li").first())}(e,s):l-5<n&&function(e,t){C("#sortableListsHintWrapper",f.rootEl.el).length&&h.unwrap();if(e.pageX-t.offset().left<d.insertZone){if(t.next("#sortableListsPlaceholder").length)return h.css("display","none");t.after(h)}else{var s=t.children(),l=t.children(d.listSelector).last();if(l.children().last().is("#sortableListsPlaceholder"))return h.css("display","none");l.length?s.last().append(h):(t.append(h),h.wrap(r)),f.oEl&&t.iconOpen(d)}h.css("display","block"),f.isAllowed=d.isAllowed(f.cEl.el,h,h.parents("li").first())}(e,s)}(e,f),n=e,(o=f.cEl).el.css({position:"fixed",top:n.clientY-o.xyOffsetDiff.Y-o.mT,left:n.clientX-o.xyOffsetDiff.X-o.mL})}var n,o,i}function v(e){var s=f.cEl,l=C("#sortableListsHint",f.rootEl.el),n=h[0].style,o=null,i=!1,r=C("#sortableListsHintWrapper");"block"===n.display&&l.length&&f.isAllowed?(o=l,i=!0):(o=f.placeholderNode,i=!1),offset=o.offset(),s.el.animate({left:offset.left-C(window).scrollLeft()-f.cEl.mL,top:offset.top-C(window).scrollTop()-f.cEl.mT},250,function(){var e,t;t=(e=s).el[0].style,e.el.removeClass(d.currElClass+" sortableListsCurrent"),t.top="0",t.left="0",t.position="relative",t.width="auto",o.after(s.el[0]),o[0].style.display="none",n.display="none",l.remove(),r.removeAttr("id").removeClass(d.hintWrapperClass),r.length&&r.prev("div").append(a.clone(!0)),i?f.placeholderNode.slideUp(150,function(){f.placeholderNode.remove(),m(),d.onChange(s.el),d.complete(s.el),f.isDragged=!1}):(f.placeholderNode.remove(),m(),d.complete(s.el),f.isDragged=!1)}),b(f),f.doc.unbind("mousemove",g).unbind("mouseup",v)}function c(e){f.pY=e.pageY,f.pX=e.pageX,f.cY=e.clientY,f.cX=e.clientX}function b(e){clearInterval(e.upScroll),clearInterval(e.downScroll),e.upScroll=e.downScroll=!1}function m(){C(d.listSelector,f.rootEl.el).each(function(e){C(this).children().length||(C(this).prev("div").children(".sortableListsOpener").first().remove(),C(this).remove())})}},C.fn.iconOpen=function(e){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var t=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.close):"class"===e.opener.as&&t.addClass(e.opener.close).removeClass(e.opener.open)},C.fn.iconClose=function(e){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var t=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.open):"class"===e.opener.as&&t.addClass(e.opener.open).removeClass(e.opener.close)},C.fn.sortableListsToJson=function(){var l=[];return C(this).children("li").each(function(){var e=C(this),t=e.data();l.push(t);var s=e.children("ul,ol").sortableListsToJson();0<s.length?t.children=s:delete t.children}),l},C.fn.updateButtons=function(e){var t=void 0===e?0:e,s=["Up","In"],l=["Down"];0===t&&(s.push("Out"),l.push("Out"),C(this).children("li").hideButtons(["Out"])),C(this).children("li").each(function(){var e=C(this).children("ul");0<e.length&&e.updateButtons(t+1)}),C(this).children("li:first").hideButtons(s),C(this).children("li:last").hideButtons(l)},C.fn.hideButtons=function(e){for(var t=0;t<e.length;t++)C(this).find(".btn-group:first").children(".btn"+e[t]).hide()}}(jQuery),MenuEditor.updateButtons=function(e){e.find(".btnMove").show(),e.updateButtons()};