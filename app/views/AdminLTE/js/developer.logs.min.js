$(function(){$(window).resize(function(){var e=Math.max($(".main-sidebar").height()-$("#header-row").height()-$(".main-footer").height()-100);$("#container, #data, #tree, #data .content").height(e).filter(".default").css("lineHeight",e+"px")}).resize(),$("#tree").jstree({core:{data:{url:"?operation=get_node",data:function(e){return{id:e.id}}},check_callback:function(e,t,n,i,o){return(!o||!o.dnd||"i"===o.pos)&&("move_node"!==e&&"copy_node"!==e||this.get_node(t).parent!==this.get_node(n).id)},force_text:!0,themes:{responsive:!1,variant:"small",stripes:!0}},sort:function(e,t){return this.get_type(e)===this.get_type(t)?this.get_text(e)>this.get_text(t)?1:-1:this.get_type(e)>=this.get_type(t)?1:-1},contextmenu:{items:function(e){var t=$.jstree.defaults.contextmenu.items();return delete t.create.action,t.create.label="New",t.create.submenu={create_folder:{separator_after:!0,label:"Folder",action:function(e){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{type:"default"},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},create_file:{label:"File",action:function(e){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{type:"file"},"last",function(e){setTimeout(function(){t.edit(e)},0)})}}},"file"===this.get_type(e)&&delete t.create,t}},types:{default:{icon:"folder"},file:{valid_children:[],icon:"file"}},unique:{duplicate:function(e,t){return e+" "+t}},plugins:["state","dnd","sort","types","contextmenu","unique"]}).on("delete_node.jstree",function(e,t){$.get("?operation=delete_node",{id:t.node.id}).fail(function(){t.instance.refresh()})}).on("create_node.jstree",function(e,t){$.get("?operation=create_node",{type:t.node.type,id:t.node.parent,text:t.node.text}).done(function(e){t.instance.set_id(t.node,e.id)}).fail(function(){t.instance.refresh()})}).on("rename_node.jstree",function(e,t){$.get("?operation=rename_node",{id:t.node.id,text:t.text}).done(function(e){t.instance.set_id(t.node,e.id)}).fail(function(){t.instance.refresh()})}).on("move_node.jstree",function(e,t){$.get("?operation=move_node",{id:t.node.id,parent:t.parent}).done(function(e){t.instance.refresh()}).fail(function(){t.instance.refresh()})}).on("copy_node.jstree",function(e,t){$.get("?operation=copy_node",{id:t.original.id,parent:t.parent}).done(function(e){t.instance.refresh()}).fail(function(){t.instance.refresh()})}).on("changed.jstree",function(e,t){t&&t.selected&&t.selected.length?$.get("?operation=get_content&id="+t.selected.join(":"),function(e){if(e&&void 0!==e.type)switch($("#data .content").hide(),e.type){case"text":case"txt":case"md":case"htaccess":case"log":case"sql":case"php":case"js":case"json":case"css":case"html":$("#data .code").show(),$("#code").val(e.content);break;case"png":case"jpg":case"jpeg":case"bmp":case"gif":$("#data .image img").one("load",function(){$(this).css({marginTop:"-"+$(this).height()/2+"px",marginLeft:"-"+$(this).width()/2+"px"})}).attr("src",e.content),$("#data .image").show();break;default:$("#data .default").html(e.content).show()}}):($("#data .content").hide(),$("#data .default").html("Select a file from the tree.").show())})});